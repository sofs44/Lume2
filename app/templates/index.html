{% extends "base.html" %}
{% load static %}

{% block title %}Lume - P√°gina Inicial{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="jumbotron-custom text-center position-relative">
    {% if frase %}
    <h1 class="display-4">{{ frase.texto }}</h1>
    {% if user.is_authenticated %}
    <button class="btn btn-link p-0 position-absolute" style="top:10px; right:10px; font-size:24px; color:red;"
      id="btn-favoritar" data-id="{{ frase.id }}">
      ‚ù§Ô∏è
    </button>
    {% endif %}
    {% else %}
    <h1 class="display-4">Seja bem-vindo ao Lume!</h1>
    {% endif %}
    <p class="lead">Esta √© a p√°gina inicial do Lume</p>
    <p class="lead">Seja Bem Vindo(A)</p>
  </div>
</div>


<div class="container my-5">
  <div class="row justify-content-center text-center">
    <!-- index.html: troque os href dos cards -->
    <div class="col-md-3 mb-4">
      <a href="{% if user.is_authenticated %}{% url 'metas' %}{% else %}{% url 'auth' %}{% endif %}"
        style="text-decoration:none;color:inherit;">
        <div class="card shadow">
          <div class="card-body">
            <h5>Metas e Check-in</h5>
            <img src="https://img.icons8.com/ios/50/user-group-man-man.png" width="30" />
          </div>
        </div>
      </a>
    </div>

    <div class="col-md-3 mb-4">
      <a href="{% if user.is_authenticated %}{% url 'diario' %}{% else %}{% url 'auth' %}{% endif %}"
        style="text-decoration:none;color:inherit;">
        <div class="card shadow">
          <div class="card-body">
            <h5>Di√°rio Pessoal</h5>
            <img src="https://img.icons8.com/ios/50/pencil--v1.png" width="30" />
          </div>
        </div>
      </a>
    </div>

    <div class="col-md-3 mb-4">
      <a href="{% url 'conteudo' %}" style="text-decoration:none;color:inherit;">
        <div class="card shadow">
          <div class="card-body">
            <h5>Conte√∫do educativo</h5>
            <img src="https://img.icons8.com/?size=100&id=53377&format=png&color=000000" width="30" />
          </div>
        </div>
      </a>
    </div>

  </div>
</div>

{# NOTIFICA√á√ïES #}
{% if user.is_authenticated and user.usuario.tipo == 'usuario' %}
{% for notif in notificacoes %}
<div class="alert alert-info alert-dismissible fade show" role="alert" id="notificacao-{{ notif.id_notificacao }}">
  <a href="{% url 'metas' %}" style="text-decoration: none; color: inherit;">
    <strong>Voc√™ tem uma nova meta.</strong><br>
    {{ notif.meta.descricao|default:"(Sem descri√ß√£o)" }}
  </a>
  <button type="button" class="fechar-notificacao" data-id="{{ notif.id_notificacao }}">‚úñ</button>
</div>
{% empty %}
<p>Voc√™ n√£o possui novas notifica√ß√µes.</p>
{% endfor %}
{% endif %}

<script>
  document.querySelectorAll('.fechar-notificacao').forEach(btn => {
    btn.addEventListener('click', function () {
      const notifId = this.getAttribute('data-id');
      const alertDiv = this.closest('.alert');

      fetch(`/notificacao/lida/${notifId}/`, {
        method: 'POST',
        headers: {
          'X-CSRFToken': '{{ csrf_token }}',
          'Accept': 'application/json'
        }
      }).then(res => {
        if (res.ok) {
          alertDiv.remove();  // Remove a notifica√ß√£o da tela
        } else {
          console.error("Erro ao marcar como lida");
        }
      });
    });
  });

  document.addEventListener('DOMContentLoaded', function() {
  const btn = document.getElementById('btn-favoritar');
  if (btn) {
    btn.addEventListener('click', function() {
      const fraseId = this.getAttribute('data-id');
      fetch("{% url 'favoritar_frase' %}", {
        method: 'POST',
        headers: {
          'X-CSRFToken': '{{ csrf_token }}',
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: 'frase_id=' + fraseId
      })
      .then(res => res.json())
      .then(data => {
        if (data.favoritada) {
          alert('Frase adicionada aos favoritos ‚ù§Ô∏è');
        } else {
          alert('Frase removida dos favoritos üíî');
        }
      });
    });
  }
});

</script>





{% endblock %}