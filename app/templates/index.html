{% extends "base.html" %}
{% load static %}

{% block title %}Lume - Página Inicial{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="jumbotron-custom text-center">
    <h1 class="display-4">{{ frase }}</h1>
    <p class="lead">Esta é a página inicial do Lume</p>
    <p class="lead">Seja Bem Vindo(A)</p>
  </div>
</div>


<div class="container my-5">
  <div class="row justify-content-center text-center">
    <!-- index.html: troque os href dos cards -->
    <div class="col-md-3 mb-4">
      <a href="{% if user.is_authenticated %}{% url 'metas' %}{% else %}{% url 'auth' %}{% endif %}"
        style="text-decoration:none;color:inherit;">
        <div class="card shadow">
          <div class="card-body">
            <h5>Metas e Check-in</h5>
            <img src="https://img.icons8.com/ios/50/user-group-man-man.png" width="30" />
          </div>
        </div>
      </a>
    </div>

    <div class="col-md-3 mb-4">
      <a href="{% if user.is_authenticated %}{% url 'diario' %}{% else %}{% url 'auth' %}{% endif %}"
        style="text-decoration:none;color:inherit;">
        <div class="card shadow">
          <div class="card-body">
            <h5>Diário Pessoal</h5>
            <img src="https://img.icons8.com/ios/50/pencil--v1.png" width="30" />
          </div>
        </div>
      </a>
    </div>

    <div class="col-md-3 mb-4">
      <a href="{% url 'conteudo' %}" style="text-decoration:none;color:inherit;">
        <div class="card shadow">
          <div class="card-body">
            <h5>Conteúdo educativo</h5>
            <img src="https://img.icons8.com/?size=100&id=53377&format=png&color=000000" width="30" />
          </div>
        </div>
      </a>
    </div>

  </div>
</div>

{# NOTIFICAÇÕES #}
{% if user.is_authenticated and user.usuario.tipo == 'usuario' %}
  {% for notif in notificacoes %}
    <div class="alert alert-info alert-dismissible fade show" role="alert" id="notificacao-{{ notif.id_notificacao }}">
      <a href="{% url 'metas' %}" style="text-decoration: none; color: inherit;">
        <strong>Você tem uma nova meta.</strong><br>
        {{ notif.meta.descricao|default:"(Sem descrição)" }}
      </a>
      <button type="button" class="fechar-notificacao" data-id="{{ notif.id_notificacao }}">✖</button>
    </div>
  {% empty %}
    <p>Você não possui novas notificações.</p>
  {% endfor %}
{% endif %}

<script>
document.querySelectorAll('.fechar-notificacao').forEach(btn => {
  btn.addEventListener('click', function () {
    const notifId = this.getAttribute('data-id');
    const alertDiv = this.closest('.alert');

    fetch(`/notificacao/lida/${notifId}/`, {
      method: 'POST',
      headers: {
        'X-CSRFToken': '{{ csrf_token }}',
        'Accept': 'application/json'
      }
    }).then(res => {
      if (res.ok) {
        alertDiv.remove();  // Remove a notificação da tela
      } else {
        console.error("Erro ao marcar como lida");
      }
    });
  });
});

</script>





{% endblock %}